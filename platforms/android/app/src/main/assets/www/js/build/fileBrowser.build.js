"use strict";(self.webpackChunkcom_foxdebug_acode=self.webpackChunkcom_foxdebug_acode||[]).push([[104],{97371:function(e,t,r){r.r(t),r.d(t,{default:function(){return T}});var a=r(8187),n=r.n(a),i=r(53124),o=r(73305),s=r(34325),l=r(67881),d=r(50673),c=r(79870),u=r(4439),p=r(22186),f=r(17686),m=r(2802),g={html:()=>r.e(566).then(r.bind(r,67468))},h=r(98206),y={pushFolder(e,t,r,a={}){e.push({url:r,name:t,isDirectory:!0,parent:!0,type:"dir",...a})},addPath:(e="",t)=>new Promise(((r,a)=>{d.Z.multiPrompt(strings["add path"],[{id:"uri",placeholder:strings["select folder"],type:"text",required:!0,readOnly:!0,onclick(){sdcard.getStorageAccessPermission(t,(e=>{const t=n().get("#name");if(!t.value&&e){const r=window.decodeURIComponent(e)?.split(":").pop()?.split("/").pop();t.value=r??""}this.value=e}),(e=>{s.Z.error(e)}))}},{id:"name",placeholder:strings["folder name"],type:"text",required:!0,value:e}],"https://acode.foxdebug.com/faqs/224761680").then((e=>{const{name:t,uri:a}=e;r({name:t,uri:a,uuid:s.Z.uuid()})}))}))},w=r(19886),v=r(73367),Z=r(5567),b=r(44966),k=r(84564),F=r.n(k),S={async addFtp(...e){let t=!1;const{username:r,password:a,hostname:n,port:i,ftps:o,active:l,alias:c}=await function(e,t,r,a,n,i,o){return n=n||21,i=i||"ftp",o=o||"passive",d.Z.multiPrompt(strings["add ftp"],[{id:"alias",placeholder:strings.name,type:"text",value:a||"",required:!0},{id:"username",placeholder:`${strings.username} (${strings.optional})`,type:"text",value:e},{id:"hostname",placeholder:strings.hostname,type:"text",required:!0,value:r},{id:"password",placeholder:`${strings.password} (${strings.optional})`,type:"password",value:t},[`${strings["security type"]}: `,{id:"ftp",placeholder:"FTP",name:"type",type:"radio",value:"ftp"===i},{id:"ftps",placeholder:"FTPS",name:"type",type:"radio",value:"ftps"===i}],[`${strings["connection mode"]}: `,{id:"active",placeholder:"Active",name:"mode",type:"radio",value:"active"===o},{id:"passive",placeholder:"Passive",name:"mode",type:"radio",value:"passive"===o}],{id:"port",placeholder:`${strings.port} (${strings.optional})`,type:"number",value:n}])}(...e),u=o?"ftps":"ftp",p=l?"active":"passive",f=(0,b.Z)(n,r,a,i,u,p);try{d.Z.loader.create(strings["add ftp"],strings["connecting..."],{timeout:1e4,callback(){t=!0}});const e=await f.getWorkingDirectory();if(t)return void(t=!1);const o={url:h.Z.formate({protocol:"ftp:",username:r,password:a,hostname:n,port:i,path:"/",query:{mode:p,security:u}}),alias:c,name:c,type:"ftp",home:null};return"/"!==e&&(o.home=e),d.Z.loader.destroy(),o}catch(e){return t?void(t=!1):(d.Z.loader.destroy(),await s.Z.error(e),await this.addFtp(r,a,n,c,i,u,p))}},async addSftp(...e){let t=!1;const{hostname:r,username:a,keyFile:n,password:i,passPhrase:o,port:l,alias:c,usePassword:u}=await function(e,t,r,a,n,i,o,s="password"){i=i||22;const l="password"===s,c=[{id:"alias",placeholder:strings.name,type:"text",value:o||"",required:!0},{id:"username",placeholder:`${strings.username} (${strings.optional})`,type:"text",value:t},{id:"hostname",placeholder:strings.hostname,type:"text",required:!0,value:e},["Authentication type: ",{id:"usePassword",placeholder:strings.password,name:"authType",type:"radio",value:l,onchange(){this.value&&(this.prompt.$body.get("#password").hidden=!1,this.prompt.$body.get("#keyFile").hidden=!0,this.prompt.$body.get("#passPhrase").hidden=!0)}},{id:"useKeyFile",placeholder:strings["key file"],name:"authType",type:"radio",value:!l,onchange(){if(this.value){const e=this.prompt.$body.get("#password");e.hidden=!0,e.value="",this.prompt.$body.get("#keyFile").hidden=!1,this.prompt.$body.get("#passPhrase").hidden=!1}}}],{id:"password",placeholder:strings.password,name:"password",type:"password",value:a,hidden:!l},{id:"keyFile",placeholder:strings["select key file"],name:"keyFile",hidden:l,value:r,type:"text",onclick(){sdcard.openDocumentFile((e=>{this.value=e.uri}))}},{id:"passPhrase",placeholder:`${strings.passphrase} (${strings.optional})`,name:"passPhrase",type:"password",hidden:l,value:n},{id:"port",placeholder:`${strings.port} (${strings.optional})`,type:"number",value:i}];return d.Z.multiPrompt(strings["add sftp"],c)}(...e),p=u?"password":"keyFile";d.Z.loader.create(strings["add sftp"],strings["connecting..."],{timeout:1e4,callback(){t=!0}});const m=(0,Z.Z)(r,parseInt(l),a,{password:i,keyFile:n,passPhrase:o});try{const e=await m.pwd();if(t)return void(t=!1);let s="";if(n){let e=(0,f.Z)(n);const t=await e.readFile(),r=new TextDecoder("utf-8").decode(new Uint8Array(t)),a=n.hashCode();if(s=h.Z.join(DATA_STORAGE,a),e=(0,f.Z)(s),await e.exists())await e.writeFile(r);else{let e=(0,f.Z)(DATA_STORAGE);await e.createFile(a,r)}}const u=h.Z.formate({protocol:"sftp:",hostname:r,username:a,password:i,port:l,path:"/",query:{keyFile:s,passPhrase:o}});return d.Z.loader.destroy(),{alias:c,name:c,url:u,type:"sftp",home:e}}catch(e){return t?void(t=!1):(d.Z.loader.destroy(),await s.Z.error(e),await this.addSftp(r,a,n,i,o,l,c,p))}},edit({name:e,storageType:t,url:r}){let{username:a,password:n,hostname:i,port:o,query:s}=F()(r,!0);if(a&&(a=decodeURIComponent(a)),n&&(n=decodeURIComponent(n)),"ftp"===t){let{security:t,mode:r}=s;return t&&(t=decodeURIComponent(t)),r&&(r=decodeURIComponent(r)),this.addFtp(a,n,i,e,o,t,r)}if("sftp"===t){let{passPhrase:t,keyFile:r}=s;return t&&(t=decodeURIComponent(t)),r&&(r=decodeURIComponent(r)),this.addSftp(i,a,r,n,t,o,e,n?"password":"key")}return null}},x=r(72397),T=function(e,t,r,a=!0){const Z=["folder","both"].includes(e=e||"file"),b=["file","both"].includes(e),k=s.Z.parseJSON(localStorage.fileBrowserState)||[],T=[],A=[];let $=JSON.parse(localStorage.storageList||"[]");return t||(t="both"!==e?Z?strings["open folder"]:strings["open file"]:strings["file browser"]),new Promise(((r,_)=>{const E=n()("i",{className:"icon more_vert",attr:{action:"toggle-menu"}}),N=n()("i",{className:"icon add",attr:{action:"toggle-add-menu"}}),D=n()("i",{className:"icon search",attr:{action:"search"}}),I=n()("span",{className:"icon clearclose",attr:{action:"close"}}),P=(0,o.Z)(strings["file browser"].capitalize(),{lead:I}),O=n().parse(i.Z.render("<div tabindex='-1' class='main' id='file-browser' type='{{type}}'>\r\n  <div class='navigation' tabindex='-1'></div>\r\n  <div class='info'>â“˜ {{info}}</div>\r\n</div>",{type:e,info:t})),R=O.get(".navigation"),L={top:"8px",right:"8px",toggle:E,transformOrigin:"top right"},q=(0,l.Z)({innerHTML:()=>`\n        <li action="settings">${strings.settings.capitalize(0)}</li>\n        ${"/"===M.url?`<li action="refresh">${strings["reset connections"].capitalize(0)}</li>`:""}\n        <li action="reload">${strings.reload.capitalize(0)}</li>\n        `,...L}),j=(0,l.Z)({innerHTML:()=>"/"===M.url?i.Z.render("<li action='add-path'>{{add path}}</li>\r\n<li action='addFtp'>{{add ftp}}</li>\r\n<li action='addSftp'>{{add sftp}}</li>",{...strings}):i.Z.render('<li action="create" value="file">{{new file}}</li>\n<li action="create" value="folder">{{new folder}}</li>\n<li action="create" value="project">{{new project}}</li>',strings),...(L.toggle=N)&&L}),C={};let U,B={},M={url:null,name:null,list:[],scroll:0};function J(e,t){const a=e.target;let n=a.getAttribute("action");if(!n)return;let i=a.data_url,o=a.data_name||a.getAttribute("name");const l=a.hasAttribute("open-doc"),u=a.getAttribute("uuid"),p=a.getAttribute("type"),m=a.getAttribute("storageType"),g=a.getAttribute("home"),Z=["dir","directory","folder"].includes(p);if(!i){const e=a.get("data-url");e&&(i=e.textContent)}if("notification"!==m){if(!i&&"open"===n&&Z&&!l&&!t)return d.Z.loader.hide(),void y.addPath(o,u).then((e=>{const t=A.find((e=>e.uuid===u));t.url=e.uri,t.name=e.name,o=e.name,Q(t,!1),i=e.uri,b()}));switch(l&&(n="open-doc"),t&&(n="contextmenu"),n){case"navigation":b();break;case"contextmenu":!function(){if(appSettings.value.vibrateOnTap&&navigator.vibrate(c.Z.VIBRATION_TIME),"true"===a.getAttribute("open-doc"))return;const e=[["delete",strings.delete,"delete"],["rename",strings.rename,"text_format"]];/s?ftp/.test(m)&&e.push(["edit",strings.edit,"edit"]),s.Z.isFile(p)&&e.push(["info",strings.info,"info"]),d.Z.select("",e).then((e=>{switch(e){case"delete":d.Z.confirm(strings.warning.toUpperCase(),strings["delete {name}"].replace("{name}",o)).then((e=>{e&&(u?(i&&(v.Z.removeFolder(i),v.Z.removeFile(i)),$=$.filter((e=>{if(e.uuid!==u)return!0;if(e.url){const t=F()(e.url,!0),r=decodeURIComponent(t.query.keyFile||"");r&&(0,f.Z)(r).delete()}return!1})),localStorage.storageList=JSON.stringify($),ee()):async function(){try{const e=(0,f.Z)(i);if(await e.delete(),v.Z.removeFile(i),s.Z.isDir(p))s.Z.updateUriOfAllActiveFiles(i),v.Z.removeFolder(i),w.Z.removeItem(i),w.Z.removeFolders(i);else{const e=editorManager.getFile(i,"uri");e&&(e.uri=null)}delete B[i],ee(),toast(strings.success)}catch(e){s.Z.error(e)}}())}));break;case"rename":d.Z.prompt(strings.rename,o,"text",{match:c.Z.FILE_NAME_REGEX}).then((e=>{!function(e){u?function(e){$=$.map((t=>(t.uuid===u&&(t.name=e),t))),localStorage.storageList=JSON.stringify($),ee()}(e):async function(e){const t=(0,f.Z)(i);try{const r=await t.renameTo(e);w.Z.updateItem(i,r,e),toast(strings.success),ee()}catch(e){s.Z.error(e)}}(e)}(e)}));break;case"edit":S.edit($.find((e=>e.uuid===u))).then((e=>{e&&(e.uuid=u,Q(e))})).catch((e=>{e&&console.error(e)}));break;case"info":acode.exec("file-info",i)}}))}();break;case"open":Z?b():a.hasAttribute("disabled")||(P.hide(),r({type:"file",url:i,name:o}));break;case"open-doc":x.Z.check=!1,sdcard.openDocumentFile((e=>{e.url=e.uri,r({type:"file",...e,name:e.filename,mode:"single"}),P.hide()}),(e=>{s.Z.error(e)}))}}else"addstorage"===u&&re();function b(){g?function(){const e=[],t=g.split("/"),{url:r,query:a}=h.Z.parse(i);let n="";for(let i of t)n=h.Z.join(n,i),e.push({url:`${h.Z.join(r,n,"")}${a}`,name:i||o});X(e)}():H(i,o)}}function z(e){J(e,!0)}async function G(t,r){const{fileBrowser:a}=appSettings.value;let n=null,i=!1;if(t in B)return B[t];if("/"===t)n=await async function(){let e=!0;if(A.length=0,29==ANDROID_SDK_INT){const t=cordova.file.externalRootDirectory,r="Acode_Test_file"+s.Z.uuid(),a=(0,f.Z)(h.Z.join(t,r));try{await(0,f.Z)(t).createDirectory(r),await a.createFile("test"+s.Z.uuid()),e=!!(await a.lsDir()).length}catch(e){console.error(e)}finally{a.delete()}}else ANDROID_SDK_INT>29&&(e=!1);e&&y.pushFolder(A,"Internal storage",cordova.file.externalRootDirectory,{uuid:"internal-storage"});try{(await p.Z.listStorages()).forEach((e=>{if($.find((t=>t.uuid===e.uuid)))return;let t;e.path&&isStorageManager&&(t="file://"+e.path),y.pushFolder(A,e.name,t||"",{...e,storageType:"sd"})}))}catch(e){}return $.forEach((e=>{let t=e.url||e.uri;y.pushFolder(A,e.name,t,{storageType:e.storageType,uuid:e.uuid,home:e.home})})),A.length||y.pushFolder(A,strings["add a storage"],"",{storageType:"notification",uuid:"addstorage"}),b&&y.pushFolder(A,"Select document",null,{"open-doc":!0}),A}();else{const e=s.Z.uuid();C[e]=!0;const a=setTimeout((()=>{d.Z.loader.create(r,strings.loading+"...",{timeout:1e4,callback(){d.Z.loader.destroy(),H("/","/"),C[e]=!1}})}),100),o=(0,f.Z)(t);try{n=await o.lsDir()}catch(r){C[e]?s.Z.error(r,t):console.error(r)}i=!C[e],delete C[e],clearTimeout(a),d.Z.loader.destroy()}return i?null:{url:t,name:r,scroll:0,list:s.Z.sortDir(n,a,e)}}async function H(e,t,r=!0){if(!e)throw new Error('navigate(url, name): "url" is required.');if(!t)throw new Error('navigate(url, name): "name" is required.');"/"===e?Z&&(U.disabled=!0):Z&&(U.disabled=!1);const i=n().get(`#${W(e)}`);if(i){let r;for(;(r=R.lastChild)!==i;){const e=r.data_url;actionStack.remove(e),r.remove()}for(;;){const t=T.slice(-1)[0];if(!t||t.url===e)break;T.pop()}localStorage.fileBrowserState=JSON.stringify(T);const a=await G(e,t);return void(a&&Y(a))}const o=await G(e,t);if(o){const{url:n,name:i}=M;let s;a&&te({name:t,url:e}),n&&i&&r&&(s=()=>{H(n,i,!1)}),K(t,e,s),Y(o)}}function K(e,t,r){R.append(n()("span",{id:W(t),className:"nav",data_url:t,data_name:e,attr:{action:"navigation",text:e},tabIndex:-1})),R.scrollLeft=R.scrollWidth,r&&!actionStack.has(t)&&actionStack.push({id:t,action:r})}function X(e){if(!Array.isArray(e))return;const t=[],{url:r,name:n}=e.pop();let{url:i,name:o}=M;for(;e.length;){const r=e.splice(0,1)[0],{url:n,name:s}=r;let l;a&&te({name:s,url:n}),i&&o&&(t.push([i,o]),l=()=>{const[e,r]=t.pop();H(e,r,!1)}),K(s,n,l),i=n,o=s}M={url:i,name:o},H(r,n)}function W(e){return`nav_${e.hashCode()}`}function V(e){B[e]&&delete B[e],B[M.url]&&delete B[M.url];const t=new RegExp(h.Z.parse(e).url);for(let r of addedFolder)r.url===e?r.remove():t.test(M.url)&&r.reload()}function Q(e,t=!0){e.uuid?$=$.filter((t=>t.uuid!==e.uuid)):e.uuid=s.Z.uuid(),e.type||(e.type="dir"),e.storageType||(e.storageType=e.type),$.push(e),localStorage.storageList=JSON.stringify($),t&&ee()}function Y(e){const{list:t,scroll:r}=e,a=n().parse(i.Z.render('<ul class="list" id="list" empty-msg="{{msg}}">{{#list}}\r\n  {{#.}}\r\n  <li \r\n    tabindex="1" \r\n    class="tile" \r\n    action="open" \r\n    type="{{type}}" \r\n    name="{{name}}"\r\n    {{#home}}home="{{.}}"{{/home}}\r\n    {{#open-doc}}open-doc="true"{{/open-doc}} \r\n    {{#ftp-account}}ftp-account{{/ftp-account}}\r\n    {{#disabled}}disabled{{/disabled}}\r\n    {{#uuid}}uuid="{{uuid}}"{{/uuid}} \r\n    {{#storageType}}storageType="{{.}}"{{/storageType}}\r\n  >\r\n    <span \r\n      class="icon {{icon}} {{#uuid}}user-added-storage{{/uuid}}" \r\n      {{#storageType}}storageType="{{.}}"{{/storageType}}\r\n    ></span>\r\n    \r\n    <div class="text">\r\n      <span>{{name}}</span>\r\n    </div>\r\n    <data-url>{{url}}</data-url>\r\n  </li>\r\n  {{/.}}\r\n  {{/list}}\r\n</ul>',{msg:strings["empty folder message"],list:t})),o=O.get("#list");if(o){const{url:e}=M;e&&B[e]&&(B[e].scroll=o.scrollTop),o.remove()}O.append(a),a.scrollTop=r,a.focus(),M=e,B[e.url]=e}function ee(){const{url:e,name:t}=M;delete B[e],H(e,t)}function te({url:e,name:t}){e&&t&&(T.find((t=>t.url===e))||(T.push({url:e,name:t}),localStorage.fileBrowserState=JSON.stringify(T)))}function re(){y.addPath().then((e=>{$.push(e),localStorage.storageList=JSON.stringify($),ee()})).catch((e=>{s.Z.error(e)}))}actionStack.setMark(),I.onclick=P.hide,O.addEventListener("click",J),O.addEventListener("contextmenu",z),P.body=O,P.header.append(D,N,E),Z&&(U=n()("button",{className:"floating icon check",style:{bottom:"10px",top:"auto"},disabled:!0,onclick(){P.hide(),r({type:"folder",...M})}}),P.append(U)),app.append(P),s.Z.showAd(),actionStack.push({id:"filebrowser",action:function(){const e=new Error("User cancelled");Object.defineProperty(e,"code",{value:0}),_(e),P.hide()}}),q.onclick=function(e){q.hide();const t=e.target.getAttribute("action");if("settings"!==t){if("reload"===t){const{url:e}=M;return e in B&&delete B[e],void ee()}if("refresh"===t)return ftp.disconnect((()=>{}),(()=>{})),sftp.close((()=>{}),(()=>{})),void toast(strings.success)}else{!function(){const e=strings.settings.capitalize(),t=appSettings.value.fileBrowser,r=[{key:"sortByName",text:strings["sort by name"],checkbox:t.sortByName},{key:"showHiddenFiles",text:strings["show hidden files"],checkbox:t.showHiddenFiles}];(0,u.Z)(e,r,(function(e,t){appSettings.value.fileBrowser[e]=t,appSettings.update()}))}();const e=()=>{P.off("show",e),ee()};P.on("show",e)}},j.onclick=function(e){j.hide();const t=e.target,r=t.getAttribute("action"),a=t.getAttribute("value");if(r)switch(r){case"create":!async function(e){const{url:t}=M,r=[],a=[];let n="",i=null,o="",l="",u="";if("file"!==e&&"folder"!==e){if("project"===e){Object.keys(g).map((e=>{a.push([e,e,"icon "+e])})),u=await d.Z.select(strings["new project"],a),d.Z.loader.create(u,strings.loading+"..."),o=(await g[u]()).default,d.Z.loader.destroy(),l=await d.Z.prompt(strings["project name"],u,"text",{required:!0,match:c.Z.FILE_NAME_REGEX});try{const e=(0,f.Z)(t);d.Z.loader.create(l,strings.loading+"..."),await e.createDirectory(l),i=h.Z.join(t,l,"/");const r=Object.keys(o);await async function e(r){if(!r.length)return V(t),void ee();n="";const a=r.pop();return await function(e){const t=e.split("/"),r=t.pop();return p(o,e,r,t)}(a),await e(r)}(r)}catch(e){s.Z.error(e)}d.Z.loader.destroy()}}else{let r=strings["enter folder name"],a=strings["new folder"];"file"===e&&(r=strings["enter file name"],a="untitled.txt");let n=await d.Z.prompt(r,a,"filename",{match:c.Z.FILE_NAME_REGEX,required:!0});if(!n)return;n=s.Z.removeLineBreaks(n);try{const r=(0,f.Z)(t);"folder"===e&&await r.createDirectory(n),"file"===e&&await r.createFile(n),V(t),ee()}catch(e){s.Z.error(e)}}async function p(e,t,a,o){const s=h.Z.join(i,n),d=(0,f.Z)(s);if(0===o.length){const r=e[t].replace(/<%name%>/g,l);return void await d.createFile(a,r)}const c=o.splice(0,1)[0],u=h.Z.join(s,c);return r.includes(u)||(await d.createDirectory(c),r.push(u)),n+=c+"/",await p(e,t,a,o)}}(a);break;case"add-path":re();break;case"addFtp":case"addSftp":S[r]().then((e=>{Q(e)})).catch((e=>{e&&console.error(e)}))}},D.onclick=function(){const e=O.get("#list");e&&(0,m.Z)(e)},P.onhide=function(){s.Z.hideAd(),actionStack.clearFromMark(),actionStack.remove("filebrowser"),O.removeEventListener("click",J),O.removeEventListener("contextmenu",z),document.removeEventListener("resume",ee)},a&&k.length?X(k):H("/","/")}))}}}]);