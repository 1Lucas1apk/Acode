"use strict";(self.webpackChunkcom_foxdebug_acode=self.webpackChunkcom_foxdebug_acode||[]).push([[104],{72928:function(e,t,r){r.r(t),r.d(t,{default:function(){return J}});var n=r(72050),a=r(7449),i=r(64922),o=r(76972),s=r.n(o),c=r(89184),u=r.n(c),l=r(30011),d=r(71530),p=r(37519),f=r(93101),h=r(44596),g=r(59661),m=r(35265);function v(e){var t=strings.settings.capitalize(),r=appSettings.value.fileBrowser,n=[{key:"sortByName",text:strings["sort by name"],checkbox:r.sortByName},{key:"showHiddenFiles",text:strings["show hidden files"],checkbox:r.showHiddenFiles}];(0,m.Z)(t,n,(function(t,r){appSettings.value.fileBrowser[t]=r,appSettings.update(),e&&e()}))}var y="<div tabindex='-1' class='main' id='file-browser' type='{{type}}'>\r\n  <div class='navigation' tabindex='-1'></div>\r\n  <div class='info'>â“˜ {{info}}</div>\r\n</div>",b='<ul class="list" id="list" empty-msg="{{msg}}">{{#list}}\r\n  {{#.}}\r\n  <li \r\n    tabindex="1" \r\n    class="tile" \r\n    action="open" \r\n    type="{{type}}" \r\n    name="{{name}}"\r\n    {{#home}}home="{{.}}"{{/home}}\r\n    {{#open-doc}}open-doc="true"{{/open-doc}} \r\n    {{#ftp-account}}ftp-account{{/ftp-account}}\r\n    {{#disabled}}disabled{{/disabled}}\r\n    {{#uuid}}uuid="{{uuid}}"{{/uuid}} \r\n    {{#storageType}}storageType="{{.}}"{{/storageType}}\r\n  >\r\n    <span \r\n      class="icon {{icon}} {{#uuid}}user-added-storage{{/uuid}}" \r\n      {{#storageType}}storageType="{{.}}"{{/storageType}}\r\n    ></span>\r\n    \r\n    <div class="text">\r\n      <span>{{name}}</span>\r\n    </div>\r\n    <data-url>{{url}}</data-url>\r\n  </li>\r\n  {{/.}}\r\n  {{/list}}\r\n</ul>',x='<li action="create" value="file">{{new file}}</li>\n<li action="create" value="folder">{{new folder}}</li>\n<li action="create" value="project">{{new project}}</li>',Z="<li action='add-path' {{#addPathNotice}}class=\"notice\"{{/addPathNotice}}>{{add path}}</li>\r\n<li action='addFtp'>{{add ftp}}</li>\r\n<li action='addSftp' {{#addSftpNotice}}class=\"notice\"{{/addSftpNotice}}>{{add sftp}}</li>",k=r(45555),w=r(70559),S=r(64413),O={html:function(){return r.e(566).then(r.bind(r,60039))}},A=r(84734);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.push(F({url:r,name:t,isDirectory:!0,parent:!0,type:"dir"},n))},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return new Promise((function(r,n){h.Z.multiPrompt(strings["add path"],[{id:"uri",placeholder:strings["select folder"],type:"text",required:!0,readOnly:!0,onclick:function(){var e=this;sdcard.getStorageAccessPermission(t,(function(t){var r=u().get("#name");if(!r.value&&t){var n,a,i=null===(n=window.decodeURIComponent(t))||void 0===n||null===(a=n.split(":").pop())||void 0===a?void 0:a.split("/").pop();r.value=null!=i?i:""}e.value=t}),(function(e){p.Z.error(e)}))}},{id:"name",placeholder:strings["folder name"],type:"text",required:!0,value:e}],"https://acode.foxdebug.com/faqs/224761680").then((function(e){var t=e.name,n=e.uri;r({name:t,uri:n,uuid:p.Z.uuid()})}))}))},T=r(7079),D=r(63536),E=r(37827),N=r(3820),I=r(77004),L=r(86163),R=r.n(L),q={addFtp:function(){var e=arguments,t=this;return(0,a.Z)(s().mark((function r(){var n,a,i,o,c,u,l,d,f,g,m,v,y,b,x,Z;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Z=function(e,t,r,n,a,i,o){return a=a||21,i=i||"ftp",o=o||"passive",h.Z.multiPrompt(strings["add ftp"],[{id:"alias",placeholder:strings.name,type:"text",value:n||"",required:!0},{id:"username",placeholder:"".concat(strings.username," (").concat(strings.optional,")"),type:"text",value:e},{id:"hostname",placeholder:strings.hostname,type:"text",required:!0,value:r},{id:"password",placeholder:"".concat(strings.password," (").concat(strings.optional,")"),type:"password",value:t},["".concat(strings["security type"],": "),{id:"ftp",placeholder:"FTP",name:"type",type:"radio",value:"ftp"===i},{id:"ftps",placeholder:"FTPS",name:"type",type:"radio",value:"ftps"===i}],["".concat(strings["connection mode"],": "),{id:"active",placeholder:"Active",name:"mode",type:"radio",value:"active"===o},{id:"passive",placeholder:"Passive",name:"mode",type:"radio",value:"passive"===o}],{id:"port",placeholder:"".concat(strings.port," (").concat(strings.optional,")"),type:"number",value:a}])},n=!1,r.next=4,Z.apply(void 0,(0,E.Z)(e));case 4:return a=r.sent,i=a.username,o=a.password,c=a.hostname,u=a.port,l=a.ftps,d=a.active,f=a.alias,g=l?"ftps":"ftp",m=d?"active":"passive",v=(0,I.Z)(c,i,o,u,g,m),r.prev=15,h.Z.loader.create(strings["add ftp"],strings["connecting..."],{timeout:1e4,callback:function(){n=!0}}),r.next=19,v.getWorkingDirectory();case 19:if(y=r.sent,!n){r.next=23;break}return n=!1,r.abrupt("return");case 23:return b=A.Z.formate({protocol:"ftp:",username:i,password:o,hostname:c,port:u,path:"/",query:{mode:m,security:g}}),x={url:b,alias:f,name:f,type:"ftp",home:null},"/"!==y&&(x.home=y),h.Z.loader.destroy(),r.abrupt("return",x);case 30:if(r.prev=30,r.t0=r.catch(15),!n){r.next=35;break}return n=!1,r.abrupt("return");case 35:return h.Z.loader.destroy(),r.next=38,p.Z.error(r.t0);case 38:return r.next=40,t.addFtp(i,o,c,f,u,g,m);case 40:return r.abrupt("return",r.sent);case 41:case"end":return r.stop()}}),r,null,[[15,30]])})))()},addSftp:function(){var e=arguments,t=this;return(0,a.Z)(s().mark((function r(){var n,a,i,o,c,u,l,d,f,g,m,v,y,b,x,Z,k,S,O,P,F;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return F=function(e,t,r,n,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"password";i=i||22;var c="password"===s,u=[{id:"alias",placeholder:strings.name,type:"text",value:o||"",required:!0},{id:"username",placeholder:"".concat(strings.username," (").concat(strings.optional,")"),type:"text",value:t},{id:"hostname",placeholder:strings.hostname,type:"text",required:!0,value:e},["Authentication type: ",{id:"usePassword",placeholder:strings.password,name:"authType",type:"radio",value:c,onchange:function(){this.value&&(this.prompt.$body.get("#password").hidden=!1,this.prompt.$body.get("#keyFile").hidden=!0,this.prompt.$body.get("#passPhrase").hidden=!0)}},{id:"useKeyFile",placeholder:strings["key file"],name:"authType",type:"radio",value:!c,onchange:function(){if(this.value){var e=this.prompt.$body.get("#password");e.hidden=!0,e.value="",this.prompt.$body.get("#keyFile").hidden=!1,this.prompt.$body.get("#passPhrase").hidden=!1}}}],{id:"password",placeholder:strings.password,name:"password",type:"password",value:n,hidden:!c},{id:"keyFile",placeholder:strings["select key file"],name:"keyFile",hidden:c,value:r,type:"text",onclick:function(){var e=this;sdcard.openDocumentFile((function(t){e.value=t.uri}))}},{id:"passPhrase",placeholder:"".concat(strings.passphrase," (").concat(strings.optional,")"),name:"passPhrase",type:"password",hidden:c,value:a},{id:"port",placeholder:"".concat(strings.port," (").concat(strings.optional,")"),type:"number",value:i}];return h.Z.multiPrompt(strings["add sftp"],u)},n=!1,r.next=4,F.apply(void 0,(0,E.Z)(e));case 4:return a=r.sent,i=a.hostname,o=a.username,c=a.keyFile,u=a.password,l=a.passPhrase,d=a.port,f=a.alias,g=a.usePassword,m=g?"password":"keyFile",h.Z.loader.create(strings["add sftp"],strings["connecting..."],{timeout:1e4,callback:function(){n=!0}}),v=(0,N.Z)(i,parseInt(d),o,{password:u,keyFile:c,passPhrase:l}),r.prev=16,r.next=19,v.pwd();case 19:if(y=r.sent,!n){r.next=23;break}return n=!1,r.abrupt("return");case 23:if(b="",!c){r.next=44;break}return x=(0,w.Z)(c),r.next=28,x.readFile();case 28:return Z=r.sent,k=new TextDecoder("utf-8").decode(new Uint8Array(Z)),S=c.hashCode(),b=A.Z.join(DATA_STORAGE,S),x=(0,w.Z)(b),r.next=35,x.exists();case 35:if(!r.sent){r.next=41;break}return r.next=39,x.writeFile(k);case 39:r.next=44;break;case 41:return O=(0,w.Z)(DATA_STORAGE),r.next=44,O.createFile(S,k);case 44:return P=A.Z.formate({protocol:"sftp:",hostname:i,username:o,password:u,port:d,path:"/",query:{keyFile:b,passPhrase:l}}),h.Z.loader.destroy(),r.abrupt("return",{alias:f,name:f,url:P,type:"sftp",home:y});case 49:if(r.prev=49,r.t0=r.catch(16),!n){r.next=54;break}return n=!1,r.abrupt("return");case 54:return h.Z.loader.destroy(),r.next=57,p.Z.error(r.t0);case 57:return r.next=59,t.addSftp(i,o,c,u,l,d,f,m);case 59:return r.abrupt("return",r.sent);case 60:case"end":return r.stop()}}),r,null,[[16,49]])})))()},edit:function(e){var t=e.name,r=e.storageType,n=e.url,a=R()(n,!0),i=a.username,o=a.password,s=a.hostname,c=a.port,u=a.query;if(i&&(i=decodeURIComponent(i)),o&&(o=decodeURIComponent(o)),"ftp"===r){var l=u.security,d=u.mode;return l&&(l=decodeURIComponent(l)),d&&(d=decodeURIComponent(d)),this.addFtp(i,o,s,t,c,l,d)}if("sftp"===r){var p=u.passPhrase,f=u.keyFile;return p&&(p=decodeURIComponent(p)),f&&(f=decodeURIComponent(f)),this.addSftp(s,i,f,o,p,c,t,o?"password":"key")}return null}};function C(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?U(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var J=function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=["folder","both"].includes(e=e||"file"),c=["file","both"].includes(e),m=p.Z.parseJSON(localStorage.fileBrowserState)||[],P=[],F=[],E=JSON.parse(localStorage.storageList||"[]");return t||(t="both"!==e?o?strings["open folder"]:strings["open file"]:strings["file browser"]),new Promise((function(r,N){var I,L=u()("i",{className:"icon more_vert",attr:{action:"toggle-menu"}}),U=u()("i",{className:"icon add",attr:{action:"toggle-add-menu"}}),M=u()("i",{className:"icon search",attr:{action:"search"}}),J=u()("span",{className:"icon clearclose",attr:{action:"close"}}),$=(0,d.Z)(strings["file browser"].capitalize(),{lead:J}),z=u().parse(l.Z.render(y,{type:e,info:t})),G=z.get(".navigation"),H={top:"8px",right:"8px",toggle:L,transformOrigin:"top right"},K=(0,f.Z)(B({innerHTML:function(){return'\n        <li action="settings">'.concat(strings.settings.capitalize(0),"</li>\n        ").concat("/"===Q.url?'<li action="refresh">'.concat(strings["reset connections"].capitalize(0),"</li>"):"",'\n        <li action="reload">').concat(strings.reload.capitalize(0),"</li>\n        ")}},H)),X=(0,f.Z)(B({innerHTML:function(){if("/"===Q.url){var e=!localStorage.__fbAddSftp,t=!localStorage.__fbAddPath;return l.Z.render(Z,B({addPathNotice:t,addSftpNotice:e},strings))}return l.Z.render(x,strings)}},(H.toggle=U)&&H)),W={},V={},Q={url:null,name:null,list:[],scroll:0};function Y(e,t){var n=e.target,i=n.getAttribute("action");if(i){var o=n.data_url,c=n.data_name||n.getAttribute("name"),u=n.hasAttribute("open-doc"),l=n.getAttribute("uuid"),d=n.getAttribute("type"),f=n.getAttribute("storageType"),m=n.getAttribute("home"),v=["dir","directory","folder"].includes(d);if(!o){var y=n.get("data-url");y&&(o=y.textContent)}if("notification"!==f){if(!o&&"open"===i&&v&&!u&&!t)return h.Z.loader.hide(),void _(c,l).then((function(e){var t=F.find((function(e){return e.uuid===l}));t.url=e.uri,t.name=e.name,c=e.name,fe(t,!1),o=e.uri,b()}));switch(u&&(i="open-doc"),t&&(i="contextmenu"),i){case"navigation":b();break;case"contextmenu":!function(){if(appSettings.value.vibrateOnTap&&navigator.vibrate(g.Z.VIBRATION_TIME),"true"!==n.getAttribute("open-doc")){var e=[["delete",strings.delete,"delete"],["rename",strings.rename,"text_format"]];/s?ftp/.test(f)&&e.push(["edit",strings.edit,"edit"]),p.Z.isFile(d)&&e.push(["info",strings.info,"info"]),h.Z.select("",e).then((function(e){switch(e){case"delete":h.Z.confirm(strings.warning.toUpperCase(),strings["delete {name}"].replace("{name}",c)).then(x);break;case"rename":h.Z.prompt(strings.rename,c,"text",{match:g.Z.FILE_NAME_REGEX}).then((function(e){!function(e){l?function(e){E=E.map((function(t){return t.uuid===l&&(t.name=e),t})),localStorage.storageList=JSON.stringify(E),ge()}(e):function(e){Z.apply(this,arguments)}(e)}(e)}));break;case"edit":q.edit(E.find((function(e){return e.uuid===l}))).then((function(e){e&&(e.uuid=l,fe(e))})).catch((function(e){e&&console.error(e)}));break;case"info":acode.exec("file-info",o)}}))}}();break;case"open":v?b():n.hasAttribute("disabled")||($.hide(),r({type:"file",url:o,name:c}));break;case"open-doc":sdcard.openDocumentFile((function(e){e.url=e.uri,r(B(B({type:"file"},e),{},{name:e.filename,mode:"single"})),$.hide()}),(function(e){p.Z.error(e)}))}}else"addstorage"===l&&ve()}function b(){m?function(){var e,t=[],r=m.split("/"),n=A.Z.parse(o),a=n.url,i=n.query,s="",u=C(r);try{for(u.s();!(e=u.n()).done;){var l=e.value;s=A.Z.join(s,l),t.push({url:"".concat(A.Z.join(a,s,"")).concat(i),name:l||c})}}catch(e){u.e(e)}finally{u.f()}le(t)}():oe(o,c)}function x(){l?(o&&(D.Z.removeFolder(o),D.Z.removeFile(o)),E=E.filter((function(e){if(e.uuid!==l)return!0;if(e.url){var t=R()(e.url,!0),r=decodeURIComponent(t.query.keyFile||"");r&&(0,w.Z)(r).delete()}return!1})),localStorage.storageList=JSON.stringify(E),ge()):function(){k.apply(this,arguments)}()}function Z(){return(Z=(0,a.Z)(s().mark((function e(t){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,w.Z)(o),e.prev=1,e.next=4,r.renameTo(t);case 4:n=e.sent,T.Z.updateItem(o,n,t),toast(strings.success),ge(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),p.Z.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function k(){return(k=(0,a.Z)(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,w.Z)(o),e.next=4,t.delete();case 4:D.Z.removeFile(o),p.Z.isDir(d)?(p.Z.updateUriOfAllActiveFiles(o),D.Z.removeFolder(o),T.Z.removeItem(o),T.Z.removeFolders(o)):(r=editorManager.getFile(o,"uri"))&&(r.uri=null),delete V[o],ge(),toast(strings.success),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),p.Z.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}}function ee(e){Y(e,!0)}function te(){localStorage.__fbAddPath&&localStorage.__fbAddSftp?U.classList.remove("notice"):U.classList.add("notice")}function re(){return ne.apply(this,arguments)}function ne(){return(ne=(0,a.Z)(s().mark((function e(){var t,r,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!0,F.length=0,29!=ANDROID_SDK_INT){e.next=24;break}return r=cordova.file.externalRootDirectory,n="Acode_Test_file"+p.Z.uuid(),a=(0,w.Z)(A.Z.join(r,n)),e.prev=6,e.next=9,(0,w.Z)(r).createDirectory(n);case 9:return e.next=11,a.createFile("test"+p.Z.uuid());case 11:return e.next=13,a.lsDir();case 13:t=!!e.sent.length,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),console.error(e.t0);case 19:return e.prev=19,a.delete(),e.finish(19);case 22:e.next=25;break;case 24:ANDROID_SDK_INT>29&&(t=!1);case 25:return t&&j(F,"Internal storage",cordova.file.externalRootDirectory,{uuid:"internal-storage"}),e.prev=26,e.next=29,k.Z.listStorages();case 29:e.sent.forEach((function(e){var t;E.find((function(t){return t.uuid===e.uuid}))||(e.path&&isStorageManager&&(t="file://"+e.path),j(F,e.name,t||"",B(B({},e),{},{storageType:"sd"})))})),e.next=35;break;case 33:e.prev=33,e.t1=e.catch(26);case 35:return E.forEach((function(e){var t=e.url||e.uri;j(F,e.name,t,{storageType:e.storageType,uuid:e.uuid,home:e.home})})),F.length||j(F,strings["add a storage"],"",{storageType:"notification",uuid:"addstorage"}),c&&j(F,"Select document",null,{"open-doc":!0}),e.abrupt("return",F);case 39:case"end":return e.stop()}}),e,null,[[6,16,19,22],[26,33]])})))).apply(this,arguments)}function ae(e,t){return ie.apply(this,arguments)}function ie(){return ie=(0,a.Z)(s().mark((function t(r,n){var a,i,o,c,u,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=appSettings.value.fileBrowser,i=null,o=!1,!(r in V)){t.next=7;break}return t.abrupt("return",V[r]);case 7:if("/"!==r){t.next=13;break}return t.next=10,re();case 10:i=t.sent,t.next=30;break;case 13:return c=p.Z.uuid(),W[c]=!0,u=setTimeout((function(){h.Z.loader.create(n,strings.loading+"...",{timeout:1e4,callback:function(){h.Z.loader.destroy(),oe("/","/"),W[c]=!1}})}),100),l=(0,w.Z)(r),t.prev=17,t.next=20,l.lsDir();case 20:i=t.sent,t.next=26;break;case 23:t.prev=23,t.t0=t.catch(17),W[c]?p.Z.error(t.t0,r):console.error(t.t0);case 26:o=!W[c],delete W[c],clearTimeout(u),h.Z.loader.destroy();case 30:if(!o){t.next=32;break}return t.abrupt("return",null);case 32:return t.abrupt("return",{url:r,name:n,scroll:0,list:p.Z.sortDir(i,a,e)});case 33:case"end":return t.stop()}}),t,null,[[17,23]])}))),ie.apply(this,arguments)}function oe(e,t){return se.apply(this,arguments)}function se(){return se=(0,a.Z)(s().mark((function e(t,r){var n,a,c,l,d,p,f,h,g,m,v,y=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(y.length>2&&void 0!==y[2])||y[2],t){e.next=3;break}throw new Error('navigate(url, name): "url" is required.');case 3:if(r){e.next=5;break}throw new Error('navigate(url, name): "name" is required.');case 5:if("/"===t?o&&(I.disabled=!0):o&&(I.disabled=!1),!(a=u().get("#".concat(de(t))))){e.next=22;break}for(;(c=G.lastChild)!==a;)l=c.data_url,actionStack.remove(l),c.remove();case 9:if((d=P.slice(-1)[0])&&d.url!==t){e.next=13;break}return e.abrupt("break",16);case 13:P.pop(),e.next=9;break;case 16:return localStorage.fileBrowserState=JSON.stringify(P),e.next=19,ae(t,r);case 19:return(p=e.sent)&&he(p),e.abrupt("return");case 22:return e.next=24,ae(t,r);case 24:(f=e.sent)&&(g=(h=Q).url,m=h.name,i&&me({name:r,url:t}),g&&m&&n&&(v=function(){oe(g,m,!1)}),ue(r,t,v),he(f));case 26:case"end":return e.stop()}}),e)}))),se.apply(this,arguments)}function ce(){return ce=(0,a.Z)(s().mark((function e(t){var r,n,i,o,c,u,l,d,f,m,v,y,b,x,Z,k,S,P,F;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F=function(){return F=(0,a.Z)(s().mark((function e(t,r,a,i){var u,d,p,f,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=A.Z.join(c,o),d=(0,w.Z)(u),0!==i.length){e.next=7;break}return p=t[r].replace(/<%name%>/g,l),e.next=6,d.createFile(a,p);case 6:return e.abrupt("return");case 7:if(f=i.splice(0,1)[0],h=A.Z.join(u,f),n.includes(h)){e.next=13;break}return e.next=12,d.createDirectory(f);case 12:n.push(h);case 13:return o+=f+"/",e.next=16,P(t,r,a,i);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)},P=function(e,t,r,n){return F.apply(this,arguments)},S=function(e){var t=e.split("/"),r=t.pop();return P(u,e,r,t)},k=function(){return k=(0,a.Z)(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=4;break}return pe(r),ge(),e.abrupt("return");case 4:return o="",n=t.pop(),e.next=8,S(n);case 8:return e.next=10,Z(t);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)},Z=function(e){return k.apply(this,arguments)},r=Q.url,n=[],i=[],o="",c=null,u="",l="",d="","file"!==t&&"folder"!==t){e.next=39;break}return f=strings["enter folder name"],m=strings["new folder"],"file"===t&&(f=strings["enter file name"],m="untitled.txt"),e.next=19,h.Z.prompt(f,m,"filename",{match:g.Z.FILE_NAME_REGEX,required:!0});case 19:if(v=e.sent){e.next=22;break}return e.abrupt("return");case 22:if(v=p.Z.removeLineBreaks(v),e.prev=23,y=(0,w.Z)(r),"folder"!==t){e.next=28;break}return e.next=28,y.createDirectory(v);case 28:if("file"!==t){e.next=31;break}return e.next=31,y.createFile(v);case 31:pe(r),ge(),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(23),p.Z.error(e.t0);case 38:return e.abrupt("return");case 39:if("project"!==t){e.next=67;break}return Object.keys(O).map((function(e){i.push([e,e,"icon "+e])})),e.next=43,h.Z.select(strings["new project"],i);case 43:return d=e.sent,h.Z.loader.create(d,strings.loading+"..."),e.next=47,O[d]();case 47:return u=e.sent.default,h.Z.loader.destroy(),e.next=51,h.Z.prompt(strings["project name"],d,"text",{required:!0,match:g.Z.FILE_NAME_REGEX});case 51:return l=e.sent,e.prev=52,b=(0,w.Z)(r),h.Z.loader.create(l,strings.loading+"..."),e.next=57,b.createDirectory(l);case 57:return c=A.Z.join(r,l,"/"),x=Object.keys(u),e.next=61,Z(x);case 61:e.next=66;break;case 63:e.prev=63,e.t1=e.catch(52),p.Z.error(e.t1);case 66:h.Z.loader.destroy();case 67:case"end":return e.stop()}}),e,null,[[23,35],[52,63]])}))),ce.apply(this,arguments)}function ue(e,t,r){G.append(u()("span",{id:de(t),className:"nav",data_url:t,data_name:e,attr:{action:"navigation",text:e},tabIndex:-1})),G.scrollLeft=G.scrollWidth,r&&!actionStack.has(t)&&actionStack.push({id:t,action:r})}function le(e){if(Array.isArray(e)){for(var t=[],r=e.pop(),a=r.url,o=r.name,s=Q,c=s.url,u=s.name;e.length;){var l=e.splice(0,1)[0],d=l.url,p=l.name,f=void 0;i&&me({name:p,url:d}),c&&u&&(t.push([c,u]),f=function(){var e=t.pop(),r=(0,n.Z)(e,2);oe(r[0],r[1],!1)}),ue(p,d,f),c=d,u=p}Q={url:c,name:u},oe(a,o)}}function de(e){return"nav_".concat(e.hashCode())}function pe(e){V[e]&&delete V[e],V[Q.url]&&delete V[Q.url];var t,r=new RegExp(A.Z.parse(e).url),n=C(addedFolder);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.url===e?a.remove():r.test(Q.url)&&a.reload()}}catch(e){n.e(e)}finally{n.f()}}function fe(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.uuid?E=E.filter((function(t){return t.uuid!==e.uuid})):e.uuid=p.Z.uuid(),e.type||(e.type="dir"),e.storageType||(e.storageType=e.type),E.push(e),localStorage.storageList=JSON.stringify(E),t&&ge()}function he(e){var t=e.list,r=e.scroll,n=u().parse(l.Z.render(b,{msg:strings["empty folder message"],list:t})),a=z.get("#list");if(a){var i=Q.url;i&&V[i]&&(V[i].scroll=a.scrollTop),a.remove()}z.append(n),n.scrollTop=r,n.focus(),"/"===e.url?te():(L.classList.remove("notice"),U.classList.remove("notice")),Q=e,V[e.url]=e}function ge(){var e=Q,t=e.url,r=e.name;delete V[t],oe(t,r)}function me(e){var t=e.url,r=e.name;t&&r&&(P.find((function(e){return e.url===t}))||(P.push({url:t,name:r}),localStorage.fileBrowserState=JSON.stringify(P)))}function ve(){_().then((function(e){E.push(e),localStorage.storageList=JSON.stringify(E),ge()})).catch((function(e){p.Z.error(e)}))}actionStack.setMark(),J.onclick=$.hide,z.addEventListener("click",Y),z.addEventListener("contextmenu",ee),$.body=z,$.header.append(M,U,L),o&&(I=u()("button",{className:"floating icon check",style:{bottom:"10px",top:"auto"},disabled:!0,onclick:function(){$.hide(),r(B({type:"folder"},Q))}}),$.append(I)),app.append($),p.Z.showAd(),actionStack.push({id:"filebrowser",action:function(){var e=new Error("User cancelled");Object.defineProperty(e,"code",{value:0}),N(e),$.hide()}}),K.onclick=function(e){K.hide();var t=e.target.getAttribute("action");if("settings"!==t){if("reload"===t){var r=Q.url;return r in V&&delete V[r],void ge()}if("refresh"===t)return ftp.disconnect((function(){}),(function(){})),sftp.close((function(){}),(function(){})),void toast(strings.success);te()}else v(ge)},X.onclick=function(e){X.hide();var t=e.target,r=t.getAttribute("action"),n=t.getAttribute("value");if(r){switch(r){case"create":!function(e){ce.apply(this,arguments)}(n);break;case"add-path":localStorage.__fbAddPath=!0,ve();break;case"addFtp":case"addSftp":"addSftp"===r&&(localStorage.__fbAddSftp=!0),q[r]().then((function(e){fe(e)})).catch((function(e){e&&console.error(e)}))}te()}},M.onclick=function(){var e=z.get("#list");e&&(0,S.Z)(e)},$.onhide=function(){p.Z.hideAd(),actionStack.clearFromMark(),actionStack.remove("filebrowser"),z.removeEventListener("click",Y),z.removeEventListener("contextmenu",ee),document.removeEventListener("resume",ge)},i&&m.length?le(m):oe("/","/")}))}}}]);